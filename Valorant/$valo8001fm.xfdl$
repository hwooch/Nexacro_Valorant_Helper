<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="valo8001fm" width="2000" height="980" titletext="마이페이지" onload="valo8001fm_onload" onclose="valo8001fm_onclose">
    <Layouts>
      <Layout height="980" width="2000">
        <Static id="sta_discord_name" taborder="2" top="71" height="46" font="normal 30pt/normal &quot;AppleSDGothicNeoH00&quot;" color="white" text="디스코드 이름" fittocontents="width" textAlign="right" width="218" left="250" verticalAlign="bottom"/>
        <Static id="sta_nothing" taborder="3" top="84" height="33" font="normal 22pt/normal &quot;AppleSDGothicNeoB00&quot;" color="white" text=" 님의 연동된 라이엇 아이디" fittocontents="width" textAlign="right" width="306" left="sta_discord_name:0" verticalAlign="bottom" opacity="90%"/>
        <Static id="sta_user_name" taborder="0" top="71" height="46" font="normal 30pt/normal &quot;AppleSDGothicNeoH00&quot;" color="white" text="사용자 이름" fittocontents="width" textAlign="right" width="184" left="sta_nothing:50" verticalAlign="bottom"/>
        <Static id="sta_user_tag" taborder="1" top="84" height="33" font="normal 22pt/normal &quot;AppleSDGothicNeoB00&quot;" color="white" text="사용자 태그" fittocontents="width" textAlign="right" width="133" left="sta_user_name:10" verticalAlign="bottom" opacity="90%"/>
        <Static id="sta_save_list" taborder="4" text="내가 저장한 전적 기록" left="250" top="sta_discord_name:40" height="70" background="#31313c" borderRadius="20px 20px 0px 0px" font="normal 25px/normal &quot;AppleSDGothicNeoEB00&quot;" color="white" padding="0px 20px" border="0px,0px,2px #1f2326" width="254"/>
        <ListView id="list_match_list" taborder="5" left="250" top="sta_save_list:0" height="353" binddataset="ds_list" border="0px none" right="250" background="transparent" oncellclick="list_match_list_oncellclick" onmousemove="list_match_list_onmousemove" bandinitstatus="collapse">
          <Formats>
            <Format id="default">
              <Band id="body" width="100%" height="150" background="transparent" border="0px none" borderRadius="10px 10px" expandbartype="false">
                <Cell id="cell_win_background" left="10" top="10" right="0" bottom="0" background="bind:RESULT_COLOR" borderRadius="0px 10px 10px 0px" text=""/>
                <Cell id="Cell20" left="20" top="20" width="155" height="35" text="bind:START_TIME" font="normal 16px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="#7f9eb1"/>
                <Cell id="cell_result" left="20" top="63" width="155" height="35" text="bind:RESULT" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="white"/>
                <Cell id="Cell24" left="20" width="155" text="bind:PLAY_TIME" height="35" top="106" font="normal 16px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="#7f9eb1"/>
                <Cell id="cell_match_agent_icon" left="190" top="20" width="90" height="90" font="normal 16px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="imagecontrol"/>
                <Cell id="cell_rank" left="200" width="70" height="25" text="expr:RANK + &quot;등&quot;" background="#57646f" bottom="9" font="normal 16px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="white" borderRadius="20px"/>
                <Cell id="Cell27" left="314" top="33" width="33" height="37" text="bind:KILL" font="normal 24px/normal &quot;AppleSDGothicNeoH00&quot;" displaytype="text" color="white"/>
                <Cell id="Cell28" left="349" top="33" width="15" height="37" text="/" textAlign="center" font="normal 24px/normal &quot;AppleSDGothicNeoH00&quot;" displaytype="text" color="#8f9eb1"/>
                <Cell id="Cell29" left="367" top="33" width="33" height="37" text="bind:DEATH" font="normal 24px/normal &quot;AppleSDGothicNeoH00&quot;" displaytype="text" color="#e84057"/>
                <Cell id="Cell30" left="402" top="33" width="15" height="37" text="/" textAlign="center" font="normal 24px/normal &quot;AppleSDGothicNeoH00&quot;" displaytype="text" color="#8f9eb1"/>
                <Cell id="Cell31" left="420" top="33" width="33" height="37" text="bind:ASSIST" font="normal 24px/normal &quot;AppleSDGothicNeoH00&quot;" displaytype="text" color="white"/>
                <Cell id="Cell32" left="316" top="74" width="135" height="31" text="expr:(( parseInt(KILL) + parseInt(ASSIST) ) / (parseInt(DEATH) == 0 ? 1 : parseInt(DEATH)) ).toFixed(2) + &quot; : 1 평점&quot;" textAlign="center" font="normal 16px/normal &quot;AppleSDGothicNeoB00&quot;" color="#8f9eb1"/>
                <Cell id="Cell33" left="316" top="104" width="135" height="21" text="bind:TIER" textAlign="center" font="normal 16px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="#9e9eb1"/>
                <Cell id="Cell34" left="501" top="28" width="135" height="45" text="bind:MAP" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="#9e9eb1" textAlign="center"/>
                <Cell id="Cell35" left="503" top="73" width="40" height="45" text="bind:MY_SCORE" font="normal 34px/normal &quot;AppleSDGothicNeoH00&quot;" displaytype="text" color="#00bba3" textAlign="center"/>
                <Cell id="Cell36" left="548" top="73" width="40" height="45" text=":" font="normal 34px/normal &quot;AppleSDGothicNeoH00&quot;" displaytype="text" color="white" textAlign="center"/>
                <Cell id="Cell37" left="593" top="73" width="40" height="45" text="bind:ENEMY_SCORE" font="normal 34px/normal &quot;AppleSDGothicNeoH00&quot;" displaytype="text" color="#e84057" textAlign="center"/>
                <Cell id="Cell38" left="698" top="84" width="105" height="35" text="bind:KD" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="white" textAlign="center"/>
                <Cell id="Cell39" left="818" top="84" width="125" height="35" text="bind:ACS" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="white" textAlign="center"/>
                <Cell id="Cell40" left="965" top="84" width="105" height="35" text="bind:HS_RATE" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="white" textAlign="center"/>
                <Cell id="Cell41" left="1120" top="84" width="105" height="35" text="bind:ADR" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="white" textAlign="center"/>
                <Cell id="cell_win_color" left="0" top="10" width="10" bottom="0" background="bind:RESULT_BAR" borderRadius="10px 0px 0px 10px"/>
                <Cell id="Cell01" left="698" top="43" width="105" height="35" text="K/D" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="#9e9eb1" textAlign="center"/>
                <Cell id="Cell02" left="818" top="43" width="125" height="35" text="평균 전투 점수" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="#9e9eb1" textAlign="center"/>
                <Cell id="Cell03" left="1085" top="43" width="175" height="35" text="라운드당 평균 데미지" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="#9e9eb1" textAlign="center"/>
                <Cell id="Cell04" left="965" top="43" width="105" height="35" text="헤드샷 %" font="normal 20px/normal &quot;AppleSDGothicNeoB00&quot;" displaytype="text" color="#9e9eb1" textAlign="center"/>
                <Cell id="Cell00" left="0" height="10" right="0" top="0"/>
                <Cell id="cell_star" top="32" width="38" height="36" right="32" text="" imagestretch="fixaspectratio" displaytype="imagecontrol" background="url('theme://images/valo_star_fill.png') no-repeat center bottom /contain"/>
                <Cell id="cell_expand" width="38" height="36" right="32" displaytype="imagecontrol" imagestretch="fixaspectratio" bottom="12"/>
              </Band>
              <Band id="detail" width="100%" height="50">
                <Cell id="Cell00" left="40" top="7" width="278" height="36" text="asdfjkajsdlfkjdasklfj" color="white"/>
              </Band>
            </Format>
          </Formats>
        </ListView>
        <Grid id="grd_party" taborder="8" left="150" top="list_match_list:109" height="852" binddataset="gds_party" autofittype="col" border="1px solid #1f2326" background="#31313c" borderRadius="0px 20px 20px" tabstop="false" cssclass="grid_test" oncellclick="grd_party_oncellclick" scrolltype="none" scrollbartype="none none" width="1700" nodatatext="작성된 글이 존재하지 않습니다." font="normal 30pt/normal &quot;이사만루체 Medium&quot;" color="white">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="372"/>
                <Column size="85"/>
                <Column size="53"/>
                <Column size="74"/>
                <Column size="64"/>
                <Column size="106"/>
                <Column size="382"/>
                <Column size="48"/>
                <Column size="181"/>
                <Column size="48"/>
                <Column size="70"/>
                <Column size="170"/>
                <Column size="42"/>
              </Columns>
              <Rows>
                <Row size="60" band="head"/>
                <Row size="60"/>
              </Rows>
              <Band id="head">
                <Cell text="플레이어" background="#9b9baf" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,1px solid #4d4d60,1px solid black,0px none"/>
                <Cell col="1" text="마이크" background="#85859d" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,0px none,1px solid black"/>
                <Cell col="2" colspan="2" text="선호 클래스" background="#9b9baf" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,1px solid #4d4d60,1px solid black,0px none"/>
                <Cell col="4" colspan="2" text="티어" background="#85859d" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,0px none,1px solid black"/>
                <Cell col="6" text="메모" background="#9b9baf" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,1px solid #4d4d60,1px solid black,0px none"/>
                <Cell col="7" colspan="3" text="승/패" background="#85859d" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,0px none,1px solid black"/>
                <Cell col="10" text="승률" background="#9b9baf" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,1px solid #4d4d60,1px solid black,0px none"/>
                <Cell col="11" text="등록일시" background="#85859d" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,0px none,1px solid black"/>
                <Cell col="12" background="#9b9baf" font="normal 24px/normal &quot;이사만루체 Light&quot;" color="white" border="0px none,0px none,1px solid black"/>
              </Band>
              <Band id="body">
                <Cell text="expr:USER_NAME +&quot; #&quot;+ USER_TAG" border="0px,1px solid #292932,1px solid black,0px" textAlign="left" font="normal 13pt/normal &quot;이사만루체 Light&quot;" padding="0px 0px 0px 20px"/>
                <Cell col="1" textAlign="center" font="normal 15pt/normal &quot;이사만루체 Light&quot;" border="0px,1px solid #292932,1px solid black" displaytype="imagecontrol" imagestretch="fixaspectratio" text="expr:USER_MIC == 'on' ? 'theme://images/valo_mic_on_green.png' : 'theme://images/valo_mic_off_gray.png'" padding="10px"/>
                <Cell col="2" text="expr:comp.parent.fn_getClassImage(USER_CLASS)" textAlign="center" font="normal 15pt/normal &quot;이사만루체 Light&quot;" border="0px,0px,1px solid black,1px solid #292932" displaytype="imagecontrol" imagestretch="fixaspectratio" padding="10px 0px 10px 10px"/>
                <Cell col="3" text="bind:USER_CLASS" textAlign="left" font="normal 13pt/normal &quot;이사만루체 Light&quot;" border="0px,1px solid #292932,1px solid black,0px"/>
                <Cell col="4" textAlign="right" font="normal 15pt/normal &quot;이사만루체 Light&quot;" border="0px,0px,1px solid black,1px solid #292932" imagestretch="fixaspectratio" displaytype="imagecontrol" text="bind:TIER_ICON" padding="3px 0px 3px 10px"/>
                <Cell col="5" border="0px,1px solid #292932,1px solid black,0px" text="bind:TIER" font="normal 13pt/normal &quot;이사만루체 Light&quot;"/>
                <Cell col="6" text="expr:String(USER_MEMO).length &gt; 20 ? String(USER_MEMO).substr(0, 20) + &quot;. . . &quot; : USER_MEMO" textAlign="left" font="normal 13pt/normal &quot;이사만루체 Light&quot;" border="0px,1px solid #292932,1px solid black" padding="0px 0px 0px 30px" cursor="pointer"/>
                <Cell col="7" text="expr:&quot; &quot;+WINS+&quot;승&quot;" border="0px,0px,1px solid black,1px solid #292932" textAlign="center" font="normal 11pt/normal &quot;이사만루체 Light&quot;"/>
                <Cell col="8" border="0px,0px,1px solid black" font="normal 15pt/normal &quot;이사만루체 Light&quot;" displaytype="progressbarcontrol" progressbarsmooth="true" padding="10px" color="purple" expr="expr:GAMES == 0 ? 0 : (parseInt(WINS) / parseInt(GAMES)) * 100"/>
                <Cell col="9" text="expr:GAMES-WINS+&quot;패 &quot;" border="0px,1px solid #292932,1px solid black,0px" textAlign="center" font="normal 11pt/normal &quot;이사만루체 Light&quot;"/>
                <Cell col="10" border="0px,1px solid #292932,1px solid black" text="expr:WIN_RATES + &quot;%&quot;" font="normal 13pt/normal &quot;이사만루체 Light&quot;" textAlign="center" color="#00ffba"/>
                <Cell col="11" text="bind:WRITE_TIME" border="0px,1px solid #292932,1px solid black" textAlign="center" font="normal 11pt/normal &quot;이사만루체 Light&quot;"/>
                <Cell col="12" border="0px,0px,1px solid black,1px solid #292932" displaytype="buttoncontrol" edittype="button" text="º º º"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="sta_write_party" taborder="6" text="내가 작성한 파티 구인 글" left="grd_party:-1700" top="list_match_list:40" background="#31313c" borderRadius="20px 20px 0px 0px" font="normal 25px/normal &quot;AppleSDGothicNeoEB00&quot;" color="white" padding="0px 20px" border="0px" width="282" height="70"/>
        <Static id="sta_space_1" taborder="7" left="250" top="sta_save_list:0" height="328" right="250" visible="false" text="저장한 전적 기록이 없습니다." font="normal 30pt/normal &quot;AppleSDGothicNeoH00&quot;" textAlign="center" color="white" background="#31313c" borderRadius="0px 20px 20px"/>
        <Button id="btn_space_0" taborder="9" left="990" top="grd_party:0" width="120" height="30"/>
        <PopupMenu id="popup_menu" left="1788" top="476" width="145" height="163" onmenuclick="popup_menu_onmenuclick" innerdataset="ds_menu" idcolumn="id" levelcolumn="level" captioncolumn="caption" cssclass="test"/>
        <Button id="btn_toggle_list" taborder="10" left="sta_save_list:20" top="162" width="60" height="60" onclick="btn_collapse_onclick" cssclass="toggle_collapse"/>
        <Button id="btn_toggle_party" taborder="11" left="sta_write_party:20" top="list_match_list:45" width="60" height="60" onclick="btn_collapse_onclick" cssclass="toggle_collapse"/>
        <Static id="sta_space_2" taborder="12" left="150" top="sta_write_party:0" height="328" visible="false" text="작성한 글이 없습니다." font="normal 30pt/normal &quot;AppleSDGothicNeoH00&quot;" textAlign="center" color="white" background="#31313c" borderRadius="0px 20px 20px" width="1700"/>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[this.fvApp = nexacro.getApplication();

// 현재 작업 중인 게시글 번호 (비어있으면 신규 등록, 값이 있으면 수정)
this.fv_currentBoardNo = "";

this.valo8001fm_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{
    var discord_username = this.fvApp.gds_login.getColumn(0, "USER_NAME");
    var username         = this.fvApp.gds_login.getColumn(0, "RIOT_ID");
    var usertag          = this.fvApp.gds_login.getColumn(0, "RIOT_TAG");
    
    this.sta_discord_name.text = discord_username;
    this.sta_user_name.text = username;
	if( username == "연동된 계정이 존재하지 않습니다." ){
		this.sta_nothing.text = "님, 디스코드에 라이엇 계정 연동이 필요합니다.";
		this.sta_user_name.text = "";
		this.sta_user_tag.text = "";
	} else {
		this.sta_user_tag.text = "#" + usertag;
	}
	
    // 저장된 전적 가져오기
    var discord_id = this.fvApp.gds_login.getColumn(0, "DISCORD_ID");
    
    var strSvcID        = "getUserSavedList";
    var strURL          = "SvcUrl::getSavedMatch.do";
    var strInDatasets   = "";
    var strOutDatasets  = "ds_list=out_list";
    var strArgument     = "discord_id=" + nexacro.wrapQuote(discord_id);
    var strCallbackFunc = "fn_Callback";
    
    this.transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
	
	//삭제는 privateMatchController꺼 씀
	
	
	// 그리드 화면 가운데 좌표 계산
    var objGrid = this.grd_party;
    var nLeft = (this.getOffsetWidth() - objGrid.getOffsetWidth()) / 2;
    objGrid.left = nLeft;
	this.sta_space_2.left = nLeft;
	
	this.fvApp.gds_party.filter("DISCORD_ID == " + discord_id);
	
	// 작성 글 조회
	this.fn_search_party_list();
	
	// 티어 가져오기
	this.fn_transaction();
};

// 트랜잭션 콜백
this.fn_Callback = function(svcId, errCode, errMsg)
{
    if(errCode < 0) {
        return;
    }
    
    if (svcId == "getUserSavedList") {
        this.list_match_list.setCellProperty("body", "cell_match_agent_icon", "background", 
            "expr:\"url('\" + AGENT_ICON + \"') no-repeat center center /contain\"");
		
		this.list_match_list.setCellProperty("body", "cell_rank", "background", 
			"expr: RANK == '1' ? '#eb9c00' : (RANK == '2' ? '#7d59ea' : '#57646f')");
		
        this.fn_resizeMatchList();
        this.resetScroll();
    }
	
	if (svcId == "deletematch"){
		// 저장된 전적 가져오기
		var discord_id = this.fvApp.gds_login.getColumn(0, "DISCORD_ID");
		
		var strSvcID        = "getUserSavedList";
		var strURL          = "SvcUrl::getSavedMatch.do";
		var strInDatasets   = "";
		var strOutDatasets  = "ds_list=out_list";
		var strArgument     = "discord_id=" + nexacro.wrapQuote(discord_id);
		var strCallbackFunc = "fn_Callback";
		
		this.transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
	}
	
	if (svcId == "searchParty"){
		this.fn_resizePartyList();
	}
	if (svcId == "deleteParty") {
        this.gfnAlert("msg.notice.complete", ["삭제"], "nodata"); //////////////////
		this.fn_search_party_list();
    }
	if (svcId == "saveParty") {
        if (this.fv_currentBoardNo != "") {
            this.gfnAlert("msg.notice.complete", ["수정"], "nodata"); //////////////////
        } else {
			this.gfnAlert("msg.notice.complete", ["등록"], "nodata"); //////////////////
        }
        this.fv_currentBoardNo = ""; // 초기화
		this.fn_search_party_list();
    }
	if (svcId == "searchTier") {
		var objEnv = nexacro.getEnvironment();
		objEnv.usewaitcursor = true;
	}
};


// 그리드 다시 그리기
this.fn_resizePartyList = function()
{
	this.fvApp.gds_party.rowposition = "-1";
    var nRowHeight = 60;
    
    var nTotalCount = this.fvApp.gds_party.getRowCount();
	
    var nNewHeight = nTotalCount * nRowHeight;
    if (nNewHeight == 0) { // 값이 없으면 높이 0
		nNewHeight = 150;
		this.grd_party.height = nNewHeight;
		this.sta_space_2.height = 150;
		this.sta_space_2.visible = "true";
	} else {
		this.grd_party.height = nNewHeight + 60 + 1;
		this.sta_space_2.height =  nNewHeight + 60 + 1;
		this.sta_space_2.visible = "false";
	}
	this.resetScroll();
};

// 전적 리스트뷰 다시 그리기
this.fn_resizeMatchList = function()
{
    var nRowHeight = 150;
    var nDetailHeight = 50;
    var nTotalCount = this.ds_list.getRowCount();
    //var nNewHeight = nTotalCount * nRowHeight;
	
	var nNewHeight = nTotalCount * nRowHeight + nDetailHeight * count;
    if (nNewHeight == 0) { // 값이 없으면 높이 0
		nNewHeight = 150;
		this.list_match_list.height = nNewHeight;
		this.sta_space_1.height = 150;
		this.sta_space_1.visible = "true";
	} else {
		this.sta_space_1.height = nNewHeight;
		this.list_match_list.height = nNewHeight;
		this.sta_space_1.visible = "false";
	}
	
    this.resetScroll();
};

// 마이페이지에서도 별 누르면 삭제 기능
var count = 0;
this.list_match_list_oncellclick = function(obj:nexacro.ListView,e:nexacro.ListViewClickEventInfo)
{
    if(e.cellid == 'cell_star')
    {
		var sMsgId = "msg.notice.delete_match";	//메세지ID
		var arrArg = "";			//메세지취환될값 배열[생략가능]
		var sPopId = sMsgId;						//메세지팝업ID[생략가능] *해당화면에서 메시지 중복사용시 구분되는값을 넣어줘야함
		var sMsgCallback = "fnMsgCallback";			//메세지콜백[생략가능] * confirm성 메시지를 사용 시 반드시 필요
		
		// function 전달
		this.gfnAlert(sMsgId, arrArg, sPopId, function(strId, strVal) {
				if (strVal == true) {
					// 확인 선택
					this.delete_user_match(e.row);
				}
				else {
					// 취소 선택
				}
			});
		
    }
	if(e.cellid == 'cell_expand')
	{
		if(obj.getBandExpandStatus(e.row))
		{
			//obj.hideDetailBand(e.row);
			count=0;
		}
		else
		{
			//obj.showDetailBand(e.row);
			count=0;
		}
		
		var nRowHeight = 150;
		var nDetailHeight = 50;
		
		var nTotalCount = this.ds_list.getRowCount();
		var nNewHeight = nTotalCount * nRowHeight + nDetailHeight * count;
		if (nNewHeight == 0) { // 값이 없으면 높이 0
			nNewHeight = 0;
			this.list_match_list.height = nNewHeight;
			this.sta_space_1.height = 150;
			this.sta_space_1.visible = "true";
		} else {
			this.sta_space_1.height = nNewHeight;
			this.list_match_list.height = nNewHeight;
			this.sta_space_1.visible = "false";
		}
		this.resetScroll();
	}
};


// 저장한 전적 삭제 함수
this.delete_user_match = function ( rowNum )
{
	this.ds_list_copy.clearData();
	
	var nRow = this.ds_list_copy.addRow();
	this.ds_list_copy.copyRow(nRow, this.ds_list, rowNum);
	
	var strsvcid        = "deletematch";
	var strurl          = "SvcUrl::deletematch.do";
	var strindatasets   = "in_list=ds_list_copy";
	var stroutdatasets  = "";
	var strargument     = "";
	var strcallbackfunc = "fn_Callback";
	
	this.transaction(strsvcid, strurl, strindatasets, stroutdatasets, strargument, strcallbackfunc);
};

this.list_match_list_onmousemove = function(obj:nexacro.ListView,e:nexacro.ListViewMouseEventInfo)
{
	if(e.cellid == 'cell_star')
	{	
		this.list_match_list.cursor = "pointer";
	}
	else{
		this.list_match_list.cursor = "default";
	}
};


this.valo8001fm_onclose = function(obj:nexacro.Form,e:nexacro.CloseEventInfo)
{
	this.fvApp.gds_party.filter("");
};

//////////////////////////////////////////////////////////////////////////
// 현재 클릭한 행(Row)을 저장할 변수 (메뉴 클릭 시 사용하기 위함)
this.fv_clickedRow = -1;

// 그리드에서 클릭하면 발생하는 함수
this.grd_party_oncellclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	if (e.cell == 6) {
		var objChildFrame = new ChildFrame("popupModal_check", 0, 0, 480, 420);
		objChildFrame.formurl = "Popup::valo3001pu.xfdl";
		objChildFrame.openalign = "center middle";
		objChildFrame.overlaycolor = "RGBA(0,0,0,0.4)";
		objChildFrame.dragmovetype = "all";
		objChildFrame.showtitlebar = false;
		objChildFrame.set_titlebarheight(40);
		objChildFrame.cssclass = "valo_popup";
		
		objChildFrame.showModal(this.getOwnerFrame(),{a:this.fvApp.gds_party.getColumn(e.row, "USER_MEMO")},  this, "fn_popupCallback");
	}
	if (e.cell == 12) {
		// 현재 클릭한 행 인덱스 저장 (삭제/수정할 때 어떤 글인지 알아야 하니까)
        this.fv_clickedRow = e.row;
		
        // 작성자 본인이면 '신고' 숨기고, 남이면 '수정/삭제' 숨기기
        // 로그인된 ID와 게시글 작성자 ID 비교
        var sLoginId = this.fvApp.gds_login.getColumn(0, "DISCORD_ID"); 
        var sWriterId = this.fvApp.gds_party.getColumn(e.row, "DISCORD_ID");
		var sPermission = this.fvApp.gds_login.getColumn(0, "PERMISSION");
		
        // 데이터셋 필터링
        if (sLoginId == sWriterId) {
            // 내 글이면: 수정, 삭제만 표시
            this.ds_menu.filter("id != 'REP'");
        } else {
			// 운영자면 남의 글도 삭제만 표시
			if ( sPermission == 1 ) {
				this.ds_menu.filter("id == 'DEL'");
			}
			// 남의 글이면: 신고만 표시
			else {
				this.ds_menu.filter("id == 'REP'");
			}
        }
		this.popup_menu.trackPopupByComponent(obj, e.clientx, e.clienty);
	}
};

this.fn_search_party_list = function ()
{	
	// 글 조회 transaction
	var strSvcID        = "searchParty";
	var strURL          = "SvcUrl::searchParty.do";
	var strInDatasets   = "";
	var strOutDatasets  = "gds_party=out_party";
	var strArgument     = "vParty_class=" + nexacro.wrapQuote("전체") + 
	" vParty_tier=" + nexacro.wrapQuote("전체");
	var strCallbackFunc = "fn_Callback";
	
	this.transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
};



this.popup_menu_onmenuclick = function(obj:nexacro.PopupMenu,e:nexacro.MenuClickEventInfo)
{
	// 선택한 메뉴의 ID (MOD, DEL, REP)
    var sId = e.id;
    
    // 아까 저장해둔 행 인덱스
    var nRow = this.fv_clickedRow;
    
    // 게시글 번호 가져오기
    var sBoardNo = this.fvApp.gds_party.getColumn(nRow, "BOARD_NO");
    
    switch(sId) 
    {
	case "MOD": // 수정
		this.fv_currentBoardNo = sBoardNo;
        //alert(nRow);
        // 현재 그리드에 있는 데이터를 꺼냄 (팝업에 넘겨주기 위해)
        var sPopupName  = this.fvApp.gds_party.getColumn(nRow, "USER_NAME");
        var sPopupTag   = this.fvApp.gds_party.getColumn(nRow, "USER_TAG");
		var sPopupMemo  = this.fvApp.gds_party.getColumn(nRow, "USER_MEMO");
        var sPopupClass = this.fvApp.gds_party.getColumn(nRow, "USER_CLASS");
		var sPopupMic   = this.fvApp.gds_party.getColumn(nRow, "USER_MIC");
        
        
        // 팝업으로 보낼 데이터
        var oArg = {
            paramMode  : "modify",
            paramName  : sPopupName,
			paramTag   : sPopupTag,
            paramMemo  : sPopupMemo,
            paramClass : sPopupClass,
			paramMic   : sPopupMic
        };
        
        // 팝업 열기
        var objChildFrame = new ChildFrame("popupModal", 0, 0, 480, 420);
        objChildFrame.formurl = "Popup::valo2001pu.xfdl";
        objChildFrame.openalign = "center middle";
        objChildFrame.overlaycolor = "RGBA(0,0,0,0.4)";
        objChildFrame.dragmovetype = "all";
        objChildFrame.showtitlebar = true;
        objChildFrame.set_titlebarheight(40);
        objChildFrame.cssclass = "valo_popup";
        
        // oArg를 두 번째 인자로 넘김
        objChildFrame.showModal(this.getOwnerFrame(), oArg, this, "fn_popupCallback");
        break;
		
	case "DEL": // 삭제
		
		// 삭제 확인 받기	
		var sMsgId = "msg.notice.one_more";	//메세지ID
		var arrArg = "";			//메세지취환될값 배열[생략가능]
		var sPopId = sMsgId;						//메세지팝업ID[생략가능] *해당화면에서 메시지 중복사용시 구분되는값을 넣어줘야함
		var sMsgCallback = "fnMsgCallback";			//메세지콜백[생략가능] * confirm성 메시지를 사용 시 반드시 필요
		
		// function 전달
		this.gfnAlert(sMsgId, arrArg, sPopId, function(strId, strVal) {
				if (strVal == true) {
					// 확인 선택
					this.fn_deleteParty(sBoardNo);
				}
				else {
					// 취소 선택
				}
			});
		break;
    }
};


// 글 내꺼면 삭제
this.fn_deleteParty = function(boardNo)
{
    var strSvcID    = "deleteParty";
    var strURL      = "SvcUrl::deleteParty.do";
    var strInDatasets  = "";
    var strOutDatasets = "";
    // 삭제할 글 번호만 보내면 됨
    var strArgument = "vBoardNo=" + nexacro.wrapQuote(boardNo);
    var strCallbackFunc = "fn_Callback";
	
    this.transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
};



this.fn_popupCallback = function(strPopupID, strReturn)
{
	if(strReturn == undefined){
		return;
	}
	if(strPopupID == "popupModal"){
		var Party_name  = strReturn.split("||")[0];
		var Party_tag   = strReturn.split("||")[1];
		var Party_memo  = strReturn.split("||")[2];
		var Party_class = strReturn.split("||")[3];
		var Party_mic   = strReturn.split("||")[4];
		var Party_discord_id = this.fvApp.gds_login.getColumn(0, "DISCORD_ID");
		var Party_board_num;
        
        if (this.fv_currentBoardNo == "" || this.fv_currentBoardNo == null) {
            Party_board_num = "new_write"; // 신규 등록
        } else {
            Party_board_num = this.fv_currentBoardNo; // DB에서 이 번호로 UPDATE
        }
		
		// 글 저장 transaction
		var strSvcID        = "saveParty";
		var strURL          = "SvcUrl::saveParty.do";
		var strInDatasets   = "in_tier=ds_tier";
		var strOutDatasets  = "gds_party=out_party";
		var strArgument     = "vParty_name=" + nexacro.wrapQuote(Party_name) + " vParty_tag=" + nexacro.wrapQuote(Party_tag)
		+ " vParty_class=" + nexacro.wrapQuote(Party_class) + " vParty_memo=" + nexacro.wrapQuote(Party_memo)
		+ " vParty_mic=" + nexacro.wrapQuote(Party_mic) + " vParty_discord_id=" + nexacro.wrapQuote(Party_discord_id)
		+ " vParty_board_num=" + nexacro.wrapQuote(Party_board_num);
		var strCallbackFunc = "fn_Callback";
		
		this.transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
	}
};


this.fn_transaction = function () {
	var objEnv = nexacro.getEnvironment();
	objEnv.usewaitcursor = false;
	
	var username = this.fvApp.gds_login.getColumn(0, "RIOT_ID");
	var usertag = this.fvApp.gds_login.getColumn(0, "RIOT_TAG");
	
	// 내 티어 조회 transaction
	var strSvcID        = "searchTier";
	var strURL          = "SvcUrl::getValorantTier.do";
	var strInDatasets   = "";
	var strOutDatasets  = "ds_tier=out_tier";
	var strArgument     = "vName=" + nexacro.wrapQuote(username) + " vTag=" + nexacro.wrapQuote(usertag);
	var strCallbackFunc = "fn_Callback";
	
	this.transaction(strSvcID, strURL, strInDatasets, strOutDatasets, strArgument, strCallbackFunc);
}






this.btn_collapse_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo) {
    if (obj.cssclass == "toggle_collapse") {
        obj.cssclass = "toggle_expand";
        
        if (obj.id == "btn_toggle_list") {
            this.list_match_list.height = 0;
			this.sta_space_1.height = 0;
        } 
        else {
            this.grd_party.height = 0;
			this.sta_space_2.height = 0;
        }
    } 
    else {
        obj.cssclass = "toggle_collapse";
        
        if (obj.id == "btn_toggle_list") {
            this.fn_resizeMatchList();
        } 
        else {
            this.fn_resizePartyList();
        }
    }
    this.resetScroll();
};



// 직업군에 따라 이미지 경로를 반환하는 함수
this.fn_getClassImage = function(sClass)
{
    var sUrl = "";
    
    switch(sClass) 
    {
	case "감시자" : 
		sUrl = "https://media.valorant-api.com/agents/roles/5fc02f99-4091-4486-a531-98459a3e95e9/displayicon.png"; // 실제 파일명으로 수정
		break;
	case "타격대" : 
		sUrl = "https://media.valorant-api.com/agents/roles/dbe8757e-9e92-4ed4-b39f-9dfc589691d4/displayicon.png"; 
		break;
	case "전략가" : 
		sUrl = "https://media.valorant-api.com/agents/roles/4ee40330-ecdd-4f2f-98a8-eb1243428373/displayicon.png"; 
		break;
	case "척후대" : 
		sUrl = "https://media.valorant-api.com/agents/roles/1b47567f-8f7b-444b-aae3-b0c634622d10/displayicon.png"; 
		break;
	default : // 전체 혹은 매칭 안될 때
		sUrl = "theme://images/valo_all.png"; 
		break;
    }
    
    return sUrl;
};]]></Script>
    <Objects>
      <Dataset id="ds_list">
        <ColumnInfo>
          <Column id="START_TIME" type="STRING" size="256"/>
          <Column id="PLAY_TIME" type="STRING" size="256"/>
          <Column id="MAP" type="STRING" size="256"/>
          <Column id="AGENT_ICON" type="STRING" size="256"/>
          <Column id="AGENT" type="STRING" size="256"/>
          <Column id="RESULT" type="STRING" size="256"/>
          <Column id="MY_SCORE" type="STRING" size="256"/>
          <Column id="ENEMY_SCORE" type="STRING" size="256"/>
          <Column id="RANK" type="STRING" size="256"/>
          <Column id="TIER" type="STRING" size="256"/>
          <Column id="KILL" type="STRING" size="256"/>
          <Column id="DEATH" type="STRING" size="256"/>
          <Column id="ASSIST" type="STRING" size="256"/>
          <Column id="KD" type="STRING" size="256"/>
          <Column id="ACS" type="STRING" size="256"/>
          <Column id="HS_RATE" type="STRING" size="256"/>
          <Column id="ADR" type="STRING" size="256"/>
          <Column id="MATCH_ID" type="STRING" size="256"/>
          <Column id="RESULT_COLOR" type="STRING" size="256"/>
          <Column id="RESULT_BAR" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_list_copy">
        <ColumnInfo>
          <Column id="START_TIME" type="STRING" size="256"/>
          <Column id="PLAY_TIME" type="STRING" size="256"/>
          <Column id="MAP" type="STRING" size="256"/>
          <Column id="AGENT_ICON" type="STRING" size="256"/>
          <Column id="AGENT" type="STRING" size="256"/>
          <Column id="RESULT" type="STRING" size="256"/>
          <Column id="MY_SCORE" type="STRING" size="256"/>
          <Column id="ENEMY_SCORE" type="STRING" size="256"/>
          <Column id="RANK" type="STRING" size="256"/>
          <Column id="TIER" type="STRING" size="256"/>
          <Column id="KILL" type="STRING" size="256"/>
          <Column id="DEATH" type="STRING" size="256"/>
          <Column id="ASSIST" type="STRING" size="256"/>
          <Column id="KD" type="STRING" size="256"/>
          <Column id="ACS" type="STRING" size="256"/>
          <Column id="HS_RATE" type="STRING" size="256"/>
          <Column id="ADR" type="STRING" size="256"/>
          <Column id="MATCH_ID" type="STRING" size="256"/>
          <Column id="DISCORD_ID" type="STRING" size="256"/>
          <Column id="USER_NAME" type="STRING" size="256"/>
          <Column id="RESULT_COLOR" type="STRING" size="256"/>
          <Column id="RESULT_BAR" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_menu">
        <ColumnInfo>
          <Column id="id" type="STRING" size="256"/>
          <Column id="caption" type="STRING" size="256"/>
          <Column id="level" type="INT" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="level">0</Col>
            <Col id="caption">  수정</Col>
            <Col id="id">MOD</Col>
          </Row>
          <Row>
            <Col id="level">0</Col>
            <Col id="caption">  삭제</Col>
            <Col id="id">DEL</Col>
          </Row>
          <Row>
            <Col id="level">0</Col>
            <Col id="caption">  신고</Col>
            <Col id="id">REP</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_tier">
        <ColumnInfo>
          <Column id="TIER_NAME" type="STRING" size="256"/>
          <Column id="RR" type="INT" size="256"/>
          <Column id="TIER_ICON" type="STRING" size="256"/>
          <Column id="SEASON_WINS" type="STRING" size="256"/>
          <Column id="SEASON_GAMES" type="STRING" size="256"/>
          <Column id="SEASON_WIN_RATE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
  </Form>
</FDL>
